<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Delft3D Project Example</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
        <link rel="stylesheet" href="https://unpkg.com/leaflet-compass/dist/leaflet-compass.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nouislider@15.7.1/dist/nouislider.min.css">
        <link rel="stylesheet" href="static/temp_style.css?v=12">
        <link rel="icon" type="image/png" href="/images/Logo.png">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <!-- Add the header -->
        <header class="header">
            <h1>Delft3D Project Example</h1>
        </header>
        <!-- Add the menu button -->
        <button type="button" id="menuBtn" onclick="toggleMenu()">
            <img src="images/menu.png" width="60px" alt="Menu">
        </button>
        <!-- Add the control panel -->
        <div id="right-side-controls">
            <button type="button" id="custom_compass_btn">
                <img src="images/compass.png?v=1"alt="Compass">
            </button>
            <!--Add Color Legend-->
            <div class="custom-colorbar">
                <div class="colorbar-wrapper">
                    <div class="colorbar-title" id="colorbar-title">Legend</div>
                    <div class="colorbar-gradient" id="colorbar-gradient"></div>
                    <div class="colorbar-labels" id="colorbar-labels">
                        <div></div> <!-- max -->
                        <div></div> <!-- 75% -->
                        <div></div> <!-- 50% -->
                        <div></div> <!-- 25% -->
                        <div></div> <!-- min -->
                    </div>
                </div>
            </div>
        </div>  
        
        <!-- Add the left side-bar menu -->
        <div id="offCanvasMenu">
            <a onclick="history.back()">Home</a>
            <a onclick="openProjectSummary('summary.json')">Project Summary</a>
            <div class="menu-item-with-submenu">
                <a class="menu-link">Points <span class="arrow">&#x25B8;</span></a>
                <div class="submenu">
                    <label class="submenu-label">
                        <input type="checkbox" onchange="this.checked ? loadData('stations.geojson', 'stations') : hideComponent('stations')"> Stations</input>
                    </label> <br>
                    <label class="submenu-label">
                        <input type="checkbox" id="pointQuery" onchange="this.checked ? makeQuery('point') : hideQuery('point')"> Query Point</input>
                    </label>
                </div>
            </div>
            <div class="menu-item-with-submenu">
                <a class="menu-link">Profile <span class="arrow">&#x25B8;</span></a>
                <div class="submenu">
                    <!-- <label class="submenu-label">
                        <input type="checkbox" onchange="this.checked ? loadData('cross_sections.geojson', 'cross_sections') : hideComponent('cross_sections')"> Cross-sections</input>
                    </label> <br> -->
                    <label class="submenu-label">
                        <input type="checkbox" id="pathQuery" onchange="this.checked ? makeQuery('path') : hideQuery('path')"> Query Profile</input>
                    </label>
                </div>
            </div>
            <div class="menu-item-with-submenu">
                <a class="menu-link">Global Parameters <span class="arrow">&#x25B8;</span></a>
                <div class="submenu">
                    <!-- Hydrodynamics -->
                    <div class="menu-item-with-submenu_1">
                        <a class="menu-link_1">â€¢ Hydrodynamics <span class="arrow_1">&#x25B8;</span></a>
                        <div class="submenu_1">
                            <a onclick="loadData('waterlevel.json', 'waterlevel', 'Water Level (m)')">- Water Level</a>
                            <a onclick="loadData('waterdepth.json', 'waterdepth', 'Water Depth (m)')">- Water Depth</a>
                        </div>
                    </div>
                    <!-- Water Balance -->
                    <div class="menu-item-with-submenu_1">
                        <a class="menu-link_1">â€¢ Water Balance <span class="arrow_1">&#x25B8;</span></a>
                        <div class="submenu_1">
                            <a onclick="loadData('water_balance_total_volume.json', 'water_balance_total_volume', 'Total Volume (m<sup>3</sup>)')">- Total Volume</a>
                            <a onclick="loadData('water_balance_storage.json', 'water_balance_storage', 'Storage (m<sup>3</sup>)')">- Storage</a>
                            <a onclick="loadData('water_balance_boundaries_in.json', 'water_balance_boundaries_in', 'Inflow (Boundaries) (m<sup>3</sup>)')">- Inflow from Boundaries</a>
                            <a onclick="loadData('water_balance_boundaries_out.json', 'water_balance_boundaries_out', 'Outflow (Boundaries) (m<sup>3</sup>)')">- Outflow from Boundaries</a>
                            <a onclick="loadData('water_balance_boundaries_total.json', 'water_balance_boundaries_total', 'Total (Boundaries) (m<sup>3</sup>)')">- Total from Boundaries</a>
                            <a onclick="loadData('water_balance_precipitation_total.json', 'water_balance_precipitation_total', 'Total (Precipitation) (m<sup>3</sup>)')">- Total from Precipitation</a>
                            <a onclick="loadData('water_balance_evaporation.json', 'water_balance_evaporation', 'Total (Precipitation) (m<sup>3</sup>)')">- Total from Evaporation</a>
                            <a onclick="loadData('water_balance_source_sink.json', 'water_balance_source_sink', 'Source/Sink (m<sup>3</sup>)')">- Source/Sink</a>
                            <a onclick="loadData('water_balance_groundwater_in.json', 'water_balance_groundwater_in', 'Inflow (Groundwater) (m<sup>3</sup>)')">- Inflow from Groundwater</a>
                            <a onclick="loadData('water_balance_groundwater_out.json', 'water_balance_groundwater_out', 'Outflow (Groundwater) (m<sup>3</sup>)')">- Outflow from Groundwater</a>
                            <a onclick="loadData('water_balance_groundwater_total.json', 'water_balance_groundwater_total', 'Total (Groundwater) (m<sup>3</sup>)')">- Total from Groundwater</a>
                            <a onclick="loadData('water_balance_precipitation_on_ground.json', 'water_balance_precipitation_on_ground', 'Precipitation on Ground (m<sup>3</sup>)')">- Precipitation on Ground</a>
                            <a onclick="loadData('water_balance_volume_error.json', 'water_balance_volume_error', 'Volume Error (%)')">- Volume Error</a>
                        </div>
                    </div>
                    <!-- Meteorological -->
                    <div class="menu-item-with-submenu_1">
                        <a class="menu-link_1">â€¢ Meteorological <span class="arrow_1">&#x25B8;</span></a>
                        <div class="submenu_1">
                            <a onclick="loadData('total_heat_flux.json', 'total_heat_flux', 'Total Heat Flux (W/m<sup>2</sup>)')">- Total Heat Flux</a>
                            <a onclick="loadData('precipitation_rate.json', 'precipitation_rate', 'Precipitation rate (mm/day)')">- Precipitation Rate</a>
                            <a onclick="loadData('wind_speed.json', 'wind_speed', 'Wind speed (m/s)')">- Wind Speed</a>
                            <a onclick="loadData('air_temperature.json', 'air_temperature', 'Air Temperature (Â°C)')">- Air Temperature</a>
                            <a onclick="loadData('relative_humidity.json', 'relative_humidity', 'Relative Humidity (%)')">- Relative Humidity</a>
                            <a onclick="loadData('solar_influx.json', 'solar_influx', 'Solar Influx (W/m<sup>2</sup>)')">- Solar Influx</a>
                            <a onclick="loadData('evaporative_heat_flux.json', 'evaporative_heat_flux', 'Evaporative Heat Flux (W/m<sup>2</sup>)')">- Evaporative Heat Flux</a>
                            <a onclick="loadData('free_convection_evaporative_heat_flux.json', 'free_convection_evaporative_heat_flux', 'Free Convection Evaporative Heat Flux (W/m<sup>2</sup>)')">- Free Convection Evaporative Heat Flux</a>
                            <a onclick="loadData('sensible_heat_flux.json', 'sensible_heat_flux', 'Sensible Heat Flux (W/m<sup>2</sup>)')">- Sensible Heat Flux</a>
                            <a onclick="loadData('free_convection_sensible_heat_flux.json', 'free_convection_sensible_heat_flux', 'Free Convection Sensible Heat Flux (W/m<sup>2</sup>)')">- Free Convection Sensible Heat Flux</a>
                            <a onclick="loadData('long_wave_back_radiation.json', 'long_wave_back_radiation', 'Long Wave Back Radiation (W/m<sup>2</sup>)')">- Long Wave Back Radiation</a>
                            <a onclick="loadData('cloudiness.json', 'cloudiness', 'Cloudiness (%)')">- Cloudiness</a>
                        </div>
                    </div>
                </div>
            </div>            
        </div>

        <!-- Add the map -->
        <div id="map_container">
            <div id="leaflet_map"></div>
            <!-- Add time slider -->
            <div id="time-controls">
                <button id="play-btn">â–¶ Play</button>
                <div id="time-slider"></div>
                <!-- <button id="export-video-btn">ðŸ’¾ Export Video</button>
                <div id="export-progress-container" style="display:none; margin-top:10px; width: 100%;">
                <div id="export-progress-bar" style="width: 0%; height: 8px; background: limegreen;
                    border-radius: 4px; transition: width 0.2s ease;"></div>
                </div> -->
            </div>
            <div id="loadingOverlay">
                <div class="loading-text">Processing Data. Please wait...</div>
                <div class="spinner"></div>
            </div>
        </div>

        <!-- Add the right side-bar menu -->
        <div id="infoPanel">
            <div id="infoPanelHeader">Spatial Parameters<span id="arrowToggle">â–²</span></div>
            <div class="menu-item-with-submenu">
                <a class="menu-link">Hydrodynamics <span class="arrow">&#x25B8;</span></a>
                <div class="submenu">
                    <a onclick="loadData('water_surface_dynamic.geojson', 'water_surface_dynamic', 'Water Surface Level (m)')">â€¢ Water Surface Level</a>
                    <a onclick="loadData('water_depth_dynamic.geojson', 'water_depth_dynamic', 'Depth Water Level (m)')">â€¢ Depth Water Level</a>
                    
                    <div class="submenu-item">
                        <span class="submenu-label">â€¢ Velocity:</span>
                        <select id="velocity-object" onchange="changeVelocity(this)">
                            <option value="" disabled selected hidden>-- Select a type --</option>
                        </select>
                    </div>
                    
                    
                    
                    <!-- <a onclick="loadData('bed_shear_stress.json', 'bed_shear_stress', 'Bed Shear Stress (kPa)')">â€¢ Bed Shear Stress</a> -->
                    <!-- <a >â€¢ Velocity (2D)</a>
                    <a >â€¢ Velocity (3D)</a>
                    <a >â€¢ Sediment Thickness</a> -->
                </div>
            </div>



            <div class="menu-item-with-submenu">
                <a class="menu-link">Water Quality <span class="arrow">&#x25B8;</span></a>
                <div class="submenu">
                    <a onclick="loadData('temperature_multilayers.geojson', 'temperature_multilayers', 'Temperature (Â°C)', 'temperature')">â€¢ Temperature</a>
                    <a onclick="loadData('salinity_multilayers.geojson', 'salinity_multilayers', 'Salinity (ppt)')">â€¢ Salinity</a>
                    <a onclick="loadData('contaminant_multilayers.geojson', 'contaminant_multilayers', 'Contaminant (Î¼g/L)')">â€¢ Contaminant</a>
                </div>
            </div>

            <div class="menu-item-with-submenu">
                <a class="menu-link">Static <span class="arrow">&#x25B8;</span></a>
                <div class="submenu">
                    <a onclick="loadData('depth_static.geojson', 'depth', 'Depth (m)')">â€¢ Bed Depth</a>
                    <!-- <a >â€¢ Cell Size</a> -->
                </div>
            </div>
            
            <div id="infoDetails">
                <div id="infoDetailsHeader">Point Info</div>
                <div id="infoDetailsContent"></div>
            </div>
        </div>

        <!-- Add a floating summary window -->
        <div id="infoWindow">
            <div id="infoHeader">Summary<span onclick="openProjectSummary('summary.json')" id="closeInfoBtn">Ã—</span></div>
            <div id="infoContent"></div>
        </div>
        
        <!-- Add a floating plot window -->
        <div id="plotWindow">
            <div id="plotHeader">Plot Window<span onclick="openPlotChart()" id="closePlotBtn">Ã—</span></div>
            <div style="padding: 0 8px;">
                <label for="select-object">Select:</label>
                <select id="select-object" onchange="changeData(this.value)"></select>
                <button type="button" id="downloadBtn" onclick="viewData()">View Data</button>
                <button type="button" id="downloadExcel" onclick="saveToExcel()">Download Excel</button>
            </div>
            <div id="plotContainer">
                <div id="myChart"></div>
            </div>
        </div>
    </body>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-compass/dist/leaflet-compass.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.26.1.min.js"></script>
    <script src="https://unpkg.com/leaflet.vectorgrid@1.3.0/dist/Leaflet.VectorGrid.bundled.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/nouislider@15.7.1/dist/nouislider.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/antimatter15/whammy/whammy.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
    
    <!-- Load the newest version of the script -->
    <script>
        const script = document.createElement('script');
        script.src = `static/temp_script.js?v=${Date.now()}`;
        document.body.appendChild(script);
    </script>
</html>